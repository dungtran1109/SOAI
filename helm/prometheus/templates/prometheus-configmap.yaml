apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-tsdb-configmap
data:
  prometheus.yml: |
    # Prometheus 3.x running in TSDB-only mode.
    # All ingestion is done via OTLP receiver or remote_write (if enabled).
    # Scraping and alerting are disabled.

    global:
      scrape_interval: 0s
      evaluation_interval: 0s

    # No scrape jobs
    scrape_configs: []

    # No alerting or recording rules
    rule_files: []

    storage:
      tsdb:
        # Prometheus 3.x setting for accepting partially out-of-order ingestion
        out_of_order_time_window: 30m

    # Native OTLP receiver (Prometheus â‰¥ 3.0)
    otlp:
      translation_strategy: UnderscoreEscapingWithSuffixes
      keep_identifying_resource_attributes: true
      promote_resource_attributes:
        - service.name
        - service.instance.id
        - service.namespace
        - service.version
        - k8s.cluster.name
        - k8s.namespace.name
        - k8s.pod.name
        - k8s.container.name
        - container.image.name
        - container.image.tag
        - cloud.region
        - cloud.availability_zone

    # Remote write is optional; disabled by default
    remote_write: []

    # Remote read is unused in TSDB-only mode
    remote_read: []

    # No alertmanagers used in TSDB-only mode
    alerting:
      alertmanagers: []
